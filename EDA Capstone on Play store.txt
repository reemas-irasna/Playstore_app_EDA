# IMPORTING REQURE LIBRARIES
import pandas as pd
import numpy as np
import matplotlib.pyplot as plt
import seaborn as sns
import plotly.express as px

#READ CSV FILE
df1 = pd.read_csv('/content/drive/MyDrive/Play Store Data.csv')
#useless Data
df1 = df1.drop(10472).reset_index(drop = True)
df1 = df1.drop(9148).reset_index(drop = True)

#TOP 5 ROWS OF DATASET
df1.head()

# LAST 5 ROWS OF DATASET
df1.tail()

# NO OF ROWS AND COLUMN IN DATASET
df1.shape

# USE INFO FUNCTION, TO KNOW THE NULL VALUES PARENT IN OUR DATASET AND DATA TYPE OF COLUMNS
df1.info()

#Data Cleaning
#change Review to int type
def get_int(elem):
    return(int(elem))

df1['Reviews'] =df1.apply(lambda x: get_int(x['Reviews']), axis = 1)

#removing outliers of size
def get_size(elem):
  if elem[-1] != 'M':
    return('1M')
  else:
    return(elem)

df1['Size'] =df1.apply(lambda x: get_size(x['Size']), axis = 1)

#making size as float
def get_size_float(elem):
  return(eval(elem[0:-1]))


df1['Size_in_mb'] =df1.apply(lambda x: get_size_float(x['Size']), axis = 1)

#change statyoe of install to 
def get_install(elem):
  if elem[-1] == '+':
    elem =elem[0:-1]
    y= elem.split(',')
    y = ''.join(y)
    return(eval(y))
  else:
    return(eval(elem))

df1['Installs'] = df1.apply(lambda x: get_install(x['Installs']), axis = 1)

#FILL NULL VALUE IN RATING
df1['Rating'].fillna(0.0, inplace = True)

#convert price into float
def get_Price(elem):
  if elem[0] == '$':
    elem =elem[1:]
    return(eval(elem))
  else:
    return(eval(elem))

df1['dollar_price'] = df1.apply(lambda x: get_Price(x['Price']), axis = 1)

#fill null value in current ver
df1['Current Ver'].fillna(0.0, inplace = True)


#fill null values and convert to float in Android Ver
df1['Android Ver'].fillna('4.0', inplace = True)
def get_ver(elem):
  if elem != 'Varies with device':
    elem =elem[0:3]
    return(eval(elem))
  else:
    return(eval('4.0'))

df1['min_Android_Ver'] = df1.apply(lambda x: get_ver(x['Android Ver']), axis = 1)

#extracted year from Last Updated
def get_year(elem):
  elem =elem[-4:]
  return(eval(elem))

df1['year'] = df1.apply(lambda x: get_year(x['Last Updated']), axis = 1)

#Create new Data frame to store all the clean and required values for EDA
data_needed = ['App', 'Category', 'Rating', 'Reviews', 'Installs', 'Type', 'year', 
       'Price', 'Content Rating', 'Size_in_mb', 'dollar_price', 'min_Android_Ver']
df_new = df1[data_needed]

df_new.head()

#Q1 Best top 3 Category app less in size for both type

top_category_app = df_new.groupby(['Category', 'Type']).agg({'Size_in_mb' : 'mean'}).sort_values(by = 'Category').reset_index()
top_category_app.head()

fig = px.histogram(top_category_app, x="Category", y="Size_in_mb",
             color='Type', barmode='group',
             height=700,title='Category vs Mean Size')
fig.show()

#Q2 Percentage of free and paid app

free, paid = 0, 0
for elem in df_new.Type:
  if elem == 'Free':
    free = free + 1
  else:
    paid = paid +1

print(free, paid)

free_percent = round((free / (free + paid)) * 100, 2)
paid_percent = round((paid / (free + paid)) * 100, 2)

f= 'free = ' + str(free_percent) + '%'
p = 'paid = ' + str(paid_percent) + '%'
label = [f, p]
x = np.array([free, paid])
plt.pie(x,  labels = label)

df_new['Type'].value_counts().plot.pie(figsize = (15,10), autopct='%1.1f%%',title='Percentage of Free and Paid App')
plt.legend()

# Q3 correlation between year and minimum android version required 
df_android=df_new.groupby(['year']).agg({'min_Android_Ver':'median'}).reset_index()
print(df_android.head())
sns.lmplot(x='year', y='min_Android_Ver',data=df_android,size=8).set(title='Correlation between Year and Android version')

fig = px.scatter(df_android, x="year", y="min_Android_Ver", trendline="ols",title='Year vs Minimum Android Version')
fig.show()


# Q4 Distribution of App by Category
df_distri=df_new.groupby(['Category']).agg({'App':'count'}).reset_index()
df_distri.head()

fig=px.bar(df_distri,x='Category', y='App',title='Distribution of App by Category',text_auto='.2s')
fig.show()
fig1 = px.pie(df_distri, values='App', names='Category', title='Distribution of App by Category')
fig1.show()

#Q5 Most review apps category wise
df_most=df_new.groupby(['Category']).agg({'Reviews':'max'}).reset_index()

fig=px.bar(df_most,x='Reviews', y='Category',title='Category vs Review',text_auto='.2s',height=800)
fig.show()

